<div class="p-4 max-w-lg mx-auto"> <!-- Changed max-w-md to max-w-lg for wider boxes -->
  <!-- Initial Search Fields Before Listing Patients -->
  <div *ngIf="!isInitialized" class="mb-4">
    <h2 class="text-lg font-semibold mb-2">Insira os seus filtros desejados</h2>
    <form (ngSubmit)="onInitialize()">
      <!-- Loop through each attribute to display checkboxes and locked input fields -->
      <div *ngFor="let attribute of searchableAttributes" class="mb-2">
        <label class="flex items-center space-x-2">
          <input
            type="checkbox"
            [(ngModel)]="searchFields[attribute.key].selected"
            name="{{attribute.key}}Selected"
          />
          <span>{{ attribute.label }}</span>
        </label>
      
        <!-- Gender select box -->
        <ng-container *ngIf="attribute.key === 'Gender'; else standardInput">
          <select
            [(ngModel)]="searchFields['Gender'].value"
            name="GenderValue"
            class="mt-1 px-3 py-2 border rounded w-full"
            [disabled]="!searchFields['Gender'].selected"
          >
            <option value="" disabled selected hidden>Selecione GÃ©nero</option>
            <option value="Male">Masculinho</option>
            <option value="Female">Feminino</option>
            <option value="Others">Outros</option>
          </select>
        </ng-container>
      
        <!-- Date picker for DateOfBirth -->
        <ng-template #standardInput>
          <input
            *ngIf="attribute.key === 'DateOfBirth'; else textInput"
            type="date"
            [(ngModel)]="searchFields['DateOfBirth'].value"
            name="DateOfBirthValue"
            class="mt-1 px-3 py-2 border rounded w-full"
            [disabled]="!searchFields['DateOfBirth'].selected"
          />
        </ng-template>
      
        <!-- Standard text input for other fields -->
        <ng-template #textInput>
          <input
            [(ngModel)]="searchFields[attribute.key].value"
            name="{{attribute.key}}Value"
            class="mt-1 px-3 py-2 border rounded w-full"
            placeholder="Insira o/a {{attribute.label}} para filtrar"
            [disabled]="!searchFields[attribute.key].selected"
          />
        </ng-template>
      </div>
      

      <button
        type="submit"
        class="mt-2 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
      >
        Search
      </button>
    </form>
  </div>

  <!-- Patient List (Shown After Initialization) -->
  <div *ngIf="isInitialized">
    <!-- Button to create a new item -->
    <button
      (click)="onCreate()"
      class="mb-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition"
    >
      Criar um novo Paciente
    </button>

    <!-- List of patients -->
    <ul class="space-y-2">
      <li
        *ngFor="let patient of patients"
        [class.bg-blue-100]="selectedItem?.id === patient.id"
        [class.border-blue-300]="selectedItem?.id === patient.id"
        class="p-3 border rounded-lg cursor-pointer bg-white border-gray-300 hover:bg-gray-100 transition"
        (click)="onSelect(patient)"
      >
        <div>
          <strong>{{ patient.MedicalRecordNumber }}</strong> <br />
          <span><strong>Nome Completo:</strong> {{ patient.FullName }}</span> <br />
          <span><strong>Email:</strong> {{ patient.Email }}</span> <br />
          <span><strong>Data de Nascimento:</strong> {{ patient.DateOfBirth | date: 'dd/MM/YYYY' }}</span>
        </div>

        <!-- Edit and delete buttons -->
        <div class="space-x-2 flex justify-end mt-2">
          <button
            (click)="onEdit(patient); $event.stopPropagation()"
            class="px-2 py-1 text-sm bg-yellow-500 text-white rounded hover:bg-yellow-600"
          >
            Editar
          </button>
          <button
            (click)="onDelete(patient); $event.stopPropagation()"
            class="px-2 py-1 text-sm bg-red-500 text-white rounded hover:bg-red-600"
          >
            Eliminar
          </button>
        </div>
      </li>
    </ul>

    <!-- Edit Modal -->
    <div
      *ngIf="isEditing"
      class="fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-50"
    >
      <div class="bg-white p-6 rounded-lg shadow-lg max-w-lg w-full"> <!-- Changed max-w-md to max-w-lg -->
        <h2 class="text-lg font-semibold mb-4">Edit Patient</h2>
        <form (ngSubmit)="submitEdit()">
          <!-- Editable Fields -->
          <div *ngFor="let attribute of editableAttributes">
            <label class="flex items-center space-x-2">
              <input
                type="checkbox"
                [(ngModel)]="editingFields[attribute.key].selected"
                name="{{attribute.key}}Selected"
              />
              <span>{{ attribute.label }}</span>
            </label>

            <input
              [(ngModel)]="editingFields[attribute.key].value"
              name="{{attribute.key}}Value"
              class="mt-1 px-3 py-2 border rounded w-full"
              placeholder="Enter new {{attribute.label}}"
              [disabled]="!editingFields[attribute.key].selected"
            />
          </div>

          <!-- Submit and Cancel Buttons -->
          <div class="mt-4 flex justify-end space-x-2">
            <button
              type="button"
              (click)="cancelEdit()"
              class="px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
            >
              Save
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
